# 토큰 기반 인증 시스템이란?

인증받은 사용자들에게 토큰을 발급하고, 서버에 요청할 때 헤더에 토큰을 함께 전달하여 유효성 검사를 한다.

## 세션 기반 인증방식과의 차이점

- 서버에서 해당 정보를 저장하고 있지 않아도된다.
- 상태를 유지하지 않는다.(Stateless)

## 토큰 기반 방식의 인증

1. 사용자가 아이디와 비밀번호로 로그인한다.
2. 서버측에서 해당 정보를 검증한다.
3. 인증이 완료되면 사용자에게 Signed토큰을 발급한다.(Signed: 서버에서 정상적으로 발급된 토큰임을 증명하는 Signature를 가진다는 뜻)
4. 클라이언트 측에서 전달받은 토큰을 저장하며 서버에 요청할때마다 해당 토큰을 함께 전달한다.
5. 서버는 토큰을 검증하고 요청에 응답한다.

## 토큰은 어떻게 만들까?

사실 토큰이라는 것은 `인증정보`를 담은 데이터 라고 생각해볼 수 있다.

JWT(Json Web Token)를 예시로 들어 구조를 살펴보자

1. Header : 토큰 타입과 사용된 암호화 알고리즘 정보를 포함
2. Payload : 사용자의 정보와 메타 데이터를 포함한다.(만료시간, 사용자 ID 등)
3. Signature : Header와 PayLoad를 활용하여 비밀키로 암호화 된다.

JWT의 구조는 위와 같다.

### JWT의 생성 과정

1. Header와 Payload부분에 필요한 데이터들을 모두 정의한다.
2. Header와 Payload부분을 Base64URL을 통해 인코딩한다.
3. `인코딩된Header.인코딩된Payload`형식의 데이터를 비밀키와 암호화 알고리즘을 활용해 서명을 생성한다.
4. Signature부분에 서명을 담는다.

## 토큰은 왜 이렇게 생긴 것인가?

토큰은 그럼 왜 저렇게 나뉘고 사용될까?

토큰에서 각각의 부분은 제 역할이 있다.

1. Header부분에서는 해당 토큰에 대한 중요한 참고자료로써 활용이 된다. `토큰 타입`, `암호화 알고리즘`을 명시함으로써 서버에서 검증을 진행할 때 사용할 알고리즘을 알 수 있게 한다.

2. Payload부분은 데이터를 담는 부분으로 토큰에 담고자 하는 인증정보를 담는다.

3. Signature부분은 `무결성 검증`을 위한 부분으로 Header에서 명시된 암호화 알고리즘을 가지고 헤더와 payload를 활용해 서명을 생성하고 `위, 변조`여부를 판별할 수 있다.
