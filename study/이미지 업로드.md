# 이미지 업로드

## 웹 페이지에서 이미지 업로드 요청 형식

해당 HTML파일을 통해 이미지를 업로드 하면, 서버에 전달되는 Request의 형식은 다음과 같다.

```
<html>
<head>
 <meta charset="UTF-8">
 <title>File upload</title>
</head>
<body>
 <form action="file_upload" method="post" enctype="multipart/form-data">
  <input type="text" name="id" value="id1">
  <input type="text" name="pw" value="pw1">
  <input type="file" name="file">
  <input type="submit">
 </form>
</body>
</html>
[출처] [HTTP] multipart/form-data 타입으로 파일 업로드 요청 HTTP 패킷|작성자 까미유
```

```
POST /file_upload HTTP/1.1
Accept: text/html, application/xhtml+xml, image/jxr, */*
Referer: http://127.0.0.1:8080/upload.html
Accept-Language: ko-KR
Content-Type: multipart/form-data; boundary=---------------------------7e22225100cb6
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko
Accept-Encoding: gzip, deflate
Host: 127.0.0.1:8080
Content-Length: 4211
Connection: Keep-Alive
Cache-Control: no-cache


-----------------------------7e22225100cb6
Content-Disposition: form-data; name="id"

id1
-----------------------------7e22225100cb6
Content-Disposition: form-data; name="pw"

pw1
-----------------------------7e22225100cb6
Content-Disposition: form-data; name="file"; filename="Chrome.LOG"
Content-Type: application/octet-stream

<<파일 내용>>
-----------------------------7e22225100cb6--
```

### 형식 분석하기

이미지를 전송하기 위한 `form`태그의 `content-type`은 `multipart/form-data`로 지정해서 사용할 수 있다.

**`multipart/form-data`란? **

위의 Request의 구조에서 볼 수 있듯이 부분(part)을 여러개로(다중)나누어져 패킷이 전달된다. 또, 해당 데이터들의 설명은 `form-data`의 형식으로 전달되는 것을 볼 수 있다.

그렇다면 왜 `multipart/form-data`를 사용해야 하는 것인가?

`form`태그 안에는 `input`태그 여러개가 들어갈 수 있다. 해당 `input`태그에는 text, image 등등 다양한 데이터들이 들어갈 수 있는데 해당 데이터들을 구분짓기 위해 하는 `인코딩 방식`이다.

그럼 구분지을 필요 없이 이미지 전송만을 위한 `input`태그 1개만 `form`태그 안에 있어도 가능할까? 생각이 들 수 있지만, 아니다.

`multipart/form-data`는 파일 전송을 위해 특별히 설계된 인코딩 방식으로 파일의 바이너리 데이터를 올바르게 전송할 수 있다. `application/x-www-form-urlencoded`방식은 텍스트만을 처리할 수 있다.

#### Content-Type의 value안에 있는 boundary

다중 부분으로 나뉘어져 데이터가 전달된다는 것을 알았다. 그러면 해당 데이터가 어떻게 이루어져 있는지(어떻게 나뉘어 있는지)를 알기 위해서는 `boundary`를 활용한다. Request의 내용을 보면 각각의 `input`태그에 입력한 데이터에 대해서 `boundary`의 구분자를 활용해 나뉘어져 있다.

#### 각 데이터 부분의 `Content-Diposition`

해당 부분이 어떠한 방식으로 데이터를 처리하는지를 지정한다. `multipart/form-data`의 경우 `form-data`의 방식을 활용한다.
