# 내부함수?

내부함수는 하나의 파일에서 export하지 않아 외부에서 활용할 수 없는 함수를 말한다.

## 내부함수를 Test하기 위해서는?

내부함수는 위에서 말한 것과 같이 외부에서 가져다 사용할 수 없다. 그렇기 때문에 test코드를 작성하면서 해당 함수를 Test하기 위해서는 import가 불가능하다.

이 내부함수를 어떻게 가져와서 Test해볼 수 있을까?

1. T**est를 위해 export를 한다.**

- 함수를 직접적으로 테스트할 수 있다.
- 캡슐화를 위반한다.
- `export`가 많아져 모듈의 인터페이스가 복잡해질 수 있다.
- 잘못된 사용의 가능성이 증가한다.

2. **테스트 전용 빌드**
   테스트 환경에서만 내부 함수를 export하는 별도의 빌드설정을 한다.

```
if(process.env.NODE_ENV === 'test') {
  module.exports._internalFunction = internalFunction;
}
```

```
// uriParser.ts
export const __test = {
  queryStringToObject // 테스트용으로만 노출
};
```

3. **의존성 주입**
   테스트하려는 내부 함수를 파라미터로 받는 형태로 리팩토링을 한다.

- export하는 함수의 `리팩토링`이 필요하다.

4. **간접 테스트**

간접 테스트는 export하지 않은 함수가 같은 파일 내 export한 함수 안에서 내부적으로 사용될 경우 export한 함수를 test한다. test할 때 input에 대한 예상 output이 일치한다면 내부적올 사용된 함수 또한 검증이 되는 것으로 판단하는 방법을 말한다.

- 캡슐화를 유지할 수 있다.
- 실제 사용 맥락에서 검증이 가능하다.(조금더 BDD에 가까운 느낌)
- 내부적으로 사용하는 함수에 대한 다양한 사이드 이펙트에 대해서 파악하기 힘들 수 있다.
